var Barrage=function(){var t=function(t){this._initConf(t);this._initDoms()};t.prototype={_id:function(t){return document.getElementById(t)},_class:function(t,e,s){var n=[],a,r,l;if(e==null)e=document.body;if(s==null)s="*";if(e.getElementsByClassName){return e.getElementsByClassName(t)}if(e.querySelectorAll){return e.querySelectorAll("."+t)}a=e.getElementsByTagName(s);r=a.length;l=new RegExp("(^|\\s)"+t+"(\\s|$)");for(i=0,j=0;i<r;i++){if(l.test(a[i].className)){n[j]=a[i];j++}}return n},_addEvent:function(t,e,i){t.attachEvent?t.attachEvent("on"+e,i):t.addEventListener(e,i,false)},_clipStr:function(t,e,i){var s=t.replace(/([^\x00-\xff])/g,"\0$1");return s.length<i?t:s.substring(e,i-3).replace(/\x00/g,"")+"..."},_extends:function(t,e){for(property in e){t[property]=e[property]}return t},_initConf:function(t){var e=this;var i=[];this.conf=this._extends({element:"barrages",cover:false,lines:8,maxList:200,maxTxtLen:60,aniSpeed:1},t);for(var s=0;s<this.conf.lines;s++){i.push(true)}this.states={timeStart:null,nextLine:0,wrapSize:null,taskList:[],lines:e.conf.lines,linesState:i,cleared:false}},_initDoms:function(){var t=this.conf,e=this.states,i,s,n,a,r,l;i=typeof t.element=="string"?this._id(t.element):t.element;i.style.position="relative";i.innerHTML+='                <div class="brg_wrap">                    <div class="brg_mask"></div>                </div>';s=this._class("brg_wrap",i,"div")[0];n=this._class("brg_mask",s,"div")[0];if(!t.cover){n.style.display="none"}if(t.top){s.style.top=t.top+"px"}if(t.left){s.style.left=t.left+"px"}a=[];for(var o=0;o<e.lines;o++){r=document.createElement("div");r.className="brg_line brg_line"+o;a.push(r);s.appendChild(r)}this.doms={element:i,wrap:s,mask:n,lines:a};e.wrapSize=i.offsetWidth},_filterTxt:function(t){t=t.replace(/(^\s*)|(\s*$)/g,"").replace(/<[^>]+>/g,"");t=this._clipStr(t,0,this.conf.maxTxtLen);return t},_getItemSize:function(t){var e=this.doms;var i=document.createElement("span");var s;i.className="brg_item";i.style.visibility="hidden";i.innerHTML=t;e.wrap.appendChild(i);s=i.offsetWidth;e.wrap.removeChild(i);return s},_showAItemInLine:function(t){var e=this;var i=this.conf,s=this.doms,n=this.states;var a=n.taskList.length;var r,l,o,c;if(!a){return}r=n.taskList.pop();c=this._filterTxt(r.txt);if(c.length==0){return}l=document.createElement("span");l.className="brg_item "+(Math.random()<.5?"brg_item_skin0":"brg_item_skin1");l.innerHTML=c;o=this._getItemSize(c);l.style.right=-o+"px";this._animateItem(l,o,t)},_animateItem:function(t,e,i){var s=this;var n=this.conf,a=this.doms,r=this.states;var l=-e;var o=r.wrapSize+e;var c=n.aniSpeed,f,h=false;this._setLineState(i,false);a.lines[i].appendChild(t);f=setInterval(function(){var e=l+c;if(r.cleared){clearInterval(f);f=null;t.parentNode.removeChild(t);return}if(e>r.wrapSize){clearInterval(f);f=null;t.parentNode.removeChild(t);return}if(e>20&&!r.linesState[i]&&!h){s._setLineState(i,true);h=true}l=e;t.style.right=e+"px"},12)},_setLineState:function(t,e){var i=this.states;i.linesState[t]=!!e;if(e){this._checkPopItem()}},_checkPopItem:function(){var t=this.states;var e=null;for(var i=0;i<t.lines;i++){if(t.linesState[i]){e=i;break}}if(e!==null){this._showAItemInLine(e)}},add:function(t){var e=this.conf,i=this.states;if(i.cleared){return}i.taskList=i.taskList.concat(t);if(i.taskList.length>e.maxList){i.taskList=i.taskList.splice(i.taskList.length-e.maxList)}this._checkPopItem()},clear:function(){var t=this.states;t.cleared=true;t.taskList=[];for(var e=0;e<t.lines;e++){this._setLineState(e,true)}},restart:function(){var t=this.states;t.cleared=false},resize:function(t){var e=this.doms,i=this.states;if(isNaN(t)||t<=0){return}e.wrap.style.width=t+"px";i.wrapSize=t}};return t}();